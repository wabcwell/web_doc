<?php
/**
 * åˆå§‹åŒ–æ–‡æ¡£ç³»ç»Ÿ - åˆ›å»º20ç¯‡å¤šå±‚çº§æ–‡æ¡£
 */

// å¼•å…¥é…ç½®æ–‡ä»¶
require_once 'config.php';
require_once 'includes/init.php';

try {
    $db = get_db();
    
    // æ¸…ç©ºç°æœ‰æ–‡æ¡£
    $db->exec("DELETE FROM documents");
    $db->exec("DELETE FROM sqlite_sequence WHERE name='documents'");
    
    // æ–‡æ¡£æ•°æ® - å¤šå±‚çº§ç»“æ„
    $docs = [
        // ç¬¬ä¸€å±‚ï¼šä¸»è¦åˆ†ç±»
        ['title' => 'ğŸ“š ç³»ç»Ÿä½¿ç”¨æŒ‡å—', 'content' => '# ç³»ç»Ÿä½¿ç”¨æŒ‡å—

æ¬¢è¿ä½¿ç”¨æ–‡æ¡£ç®¡ç†ç³»ç»Ÿï¼æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿä¸Šæ‰‹ã€‚

## ä¸»è¦åŠŸèƒ½
- æ–‡æ¡£åˆ›å»ºä¸ç®¡ç†
- å¤šå±‚çº§ç›®å½•ç»“æ„
- å…¨æ–‡æœç´¢
- ç”¨æˆ·æƒé™ç®¡ç†', 'parent_id' => null, 'sort_order' => 1],
        
        ['title' => 'ğŸ› ï¸ ç®¡ç†å‘˜æ‰‹å†Œ', 'content' => '# ç®¡ç†å‘˜æ‰‹å†Œ

ç®¡ç†å‘˜ä¸“ç”¨æ–‡æ¡£ï¼ŒåŒ…å«ç³»ç»Ÿé…ç½®å’Œç”¨æˆ·ç®¡ç†ã€‚

## ç®¡ç†å‘˜åŠŸèƒ½
- ç”¨æˆ·ç®¡ç†
- ç³»ç»Ÿè®¾ç½®
- æ–‡æ¡£å®¡æ ¸', 'parent_id' => null, 'sort_order' => 2],
        
        ['title' => 'ğŸ’¡ ç”¨æˆ·æŒ‡å—', 'content' => '# ç”¨æˆ·æŒ‡å—

æ™®é€šç”¨æˆ·ä½¿ç”¨æŒ‡å—ï¼Œå¸®åŠ©æ‚¨å¿«é€ŸæŒæ¡ç³»ç»Ÿæ“ä½œã€‚

## åŸºç¡€æ“ä½œ
- æµè§ˆæ–‡æ¡£
- æœç´¢å†…å®¹
- ä¸ªäººè®¾ç½®', 'parent_id' => null, 'sort_order' => 3],
        
        ['title' => 'ğŸ“– å¼€å‘æ–‡æ¡£', 'content' => '# å¼€å‘æ–‡æ¡£

ç³»ç»ŸæŠ€æœ¯æ–‡æ¡£ï¼ŒåŒ…å«æ¶æ„è®¾è®¡å’ŒAPIè¯´æ˜ã€‚

## æŠ€æœ¯æ ˆ
- PHP + SQLite
- Bootstrap å‰ç«¯
- Markdown æ”¯æŒ', 'parent_id' => null, 'sort_order' => 4],
        
        ['title' => 'ğŸ“‹ å¸¸è§é—®é¢˜', 'content' => '# å¸¸è§é—®é¢˜

ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚

## å¿«é€ŸæŸ¥æ‰¾
ä½¿ç”¨æœç´¢åŠŸèƒ½å¿«é€Ÿå®šä½é—®é¢˜ç­”æ¡ˆã€‚', 'parent_id' => null, 'sort_order' => 5],
        
        // ç¬¬äºŒå±‚ï¼šç³»ç»Ÿä½¿ç”¨æŒ‡å—å­æ–‡æ¡£
        ['title' => 'ğŸš€ å¿«é€Ÿå¼€å§‹', 'content' => '# å¿«é€Ÿå¼€å§‹

5åˆ†é’Ÿä¸Šæ‰‹æ–‡æ¡£ç®¡ç†ç³»ç»Ÿã€‚

## ç¬¬ä¸€æ­¥ï¼šç™»å½•
1. è®¿é—® http://localhost:8000/admin
2. ä½¿ç”¨ç”¨æˆ·åï¼šadminï¼Œå¯†ç ï¼šadmin123
3. è¿›å…¥ç®¡ç†åå°

## ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ–‡æ¡£
1. ç‚¹å‡»"æ–‡æ¡£ç®¡ç†"
2. é€‰æ‹©"æ–°å»ºæ–‡æ¡£"
3. å¡«å†™æ ‡é¢˜å’Œå†…å®¹
4. é€‰æ‹©çˆ¶çº§ç›®å½•
5. ä¿å­˜å‘å¸ƒ', 'parent_id' => 1, 'sort_order' => 1],
        
        ['title' => 'ğŸ“ æ–‡æ¡£ç¼–è¾‘å™¨', 'content' => '# æ–‡æ¡£ç¼–è¾‘å™¨ä½¿ç”¨

å¼ºå¤§çš„ Markdown ç¼–è¾‘å™¨ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆã€‚

## Markdown è¯­æ³•æ”¯æŒ
- æ ‡é¢˜ï¼š# ## ###
- åˆ—è¡¨ï¼š- 1.
- é“¾æ¥ï¼š[æ–‡æœ¬](url)
- å›¾ç‰‡ï¼š![alt](url)
- ä»£ç å—ï¼š```ä»£ç ```

## é«˜çº§åŠŸèƒ½
- è¡¨æ ¼æ”¯æŒ
- ä»£ç é«˜äº®
- æ•°å­¦å…¬å¼', 'parent_id' => 1, 'sort_order' => 2],
        
        ['title' => 'ğŸ” æœç´¢åŠŸèƒ½', 'content' => '# æœç´¢åŠŸèƒ½è¯¦è§£

å…¨æ–‡æœç´¢è®©æ‚¨å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€å†…å®¹ã€‚

## æœç´¢æŠ€å·§
- å…³é”®è¯æœç´¢ï¼šè¾“å…¥å…³é”®è¯
- ç²¾ç¡®æœç´¢ï¼šä½¿ç”¨å¼•å·
- å¤šå…³é”®è¯ï¼šç©ºæ ¼åˆ†éš”

## æœç´¢ç»“æœ
- é«˜äº®æ˜¾ç¤ºåŒ¹é…å†…å®¹
- æ˜¾ç¤ºæ–‡æ¡£è·¯å¾„
- å¿«é€Ÿè·³è½¬', 'parent_id' => 1, 'sort_order' => 3],
        
        // ç¬¬ä¸‰å±‚ï¼šå¿«é€Ÿå¼€å§‹å­æ–‡æ¡£
        ['title' => 'ğŸ‘¤ ç”¨æˆ·ç®¡ç†å…¥é—¨', 'content' => '# ç”¨æˆ·ç®¡ç†å…¥é—¨

å­¦ä¹ å¦‚ä½•ç®¡ç†ç”¨æˆ·è´¦æˆ·å’Œæƒé™ã€‚

## ç”¨æˆ·è§’è‰²
- **ç®¡ç†å‘˜**ï¼šå®Œå…¨æƒé™
- **ç¼–è¾‘è€…**ï¼šæ–‡æ¡£ç¼–è¾‘æƒé™

## æ·»åŠ æ–°ç”¨æˆ·
1. è¿›å…¥"ç”¨æˆ·ç®¡ç†"
2. ç‚¹å‡»"æ·»åŠ ç”¨æˆ·"
3. è®¾ç½®ç”¨æˆ·åå’Œå¯†ç 
4. åˆ†é…è§’è‰²', 'parent_id' => 6, 'sort_order' => 1],
        
        ['title' => 'ğŸ“ ç›®å½•ç»“æ„ç®¡ç†', 'content' => '# ç›®å½•ç»“æ„ç®¡ç†

åˆ›å»ºåˆç†çš„æ–‡æ¡£å±‚çº§ç»“æ„ã€‚

## ç›®å½•å±‚çº§
- æ”¯æŒæ— é™å±‚çº§
- æ‹–æ‹½æ’åº
- çˆ¶å­å…³ç³»

## æœ€ä½³å®è·µ
- æŒ‰åŠŸèƒ½åˆ†ç±»
- ä¿æŒå±‚çº§æ¸…æ™°
- é¿å…è¿‡æ·±åµŒå¥—', 'parent_id' => 6, 'sort_order' => 2],
        
        // ç¬¬äºŒå±‚ï¼šç®¡ç†å‘˜æ‰‹å†Œå­æ–‡æ¡£
        ['title' => 'âš™ï¸ ç³»ç»Ÿé…ç½®', 'content' => '# ç³»ç»Ÿé…ç½®æŒ‡å—

ç³»ç»Ÿç®¡ç†å‘˜é…ç½®æŒ‡å—ã€‚

## åŸºæœ¬é…ç½®
- ç½‘ç«™åç§°è®¾ç½®
- ä¸Šä¼ é™åˆ¶é…ç½®
- æ—¶åŒºè®¾ç½®

## é«˜çº§é…ç½®
- æ•°æ®åº“å¤‡ä»½
- å®‰å…¨è®¾ç½®
- æ€§èƒ½ä¼˜åŒ–', 'parent_id' => 2, 'sort_order' => 1],
        
        ['title' => 'ğŸ‘¥ ç”¨æˆ·æƒé™ç®¡ç†', 'content' => '# ç”¨æˆ·æƒé™ç®¡ç†

ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ç³»ç»Ÿã€‚

## æƒé™ç±»å‹
- æ–‡æ¡£åˆ›å»ºæƒé™
- æ–‡æ¡£ç¼–è¾‘æƒé™
- æ–‡æ¡£åˆ é™¤æƒé™
- ç”¨æˆ·ç®¡ç†æƒé™

## æƒé™åˆ†é…
åŸºäºè§’è‰²çš„æƒé™ç®¡ç†ï¼Œç®€åŒ–é…ç½®æµç¨‹ã€‚', 'parent_id' => 2, 'sort_order' => 2],
        
        ['title' => 'ğŸ“Š ç³»ç»Ÿç›‘æ§', 'content' => '# ç³»ç»Ÿç›‘æ§

ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½ã€‚

## ç›‘æ§æŒ‡æ ‡
- ç”¨æˆ·æ´»è·ƒåº¦
- æ–‡æ¡£æ•°é‡ç»Ÿè®¡
- ç³»ç»Ÿæ€§èƒ½

## æ—¥å¿—åˆ†æ
- è®¿é—®æ—¥å¿—
- é”™è¯¯æ—¥å¿—
- æ“ä½œæ—¥å¿—', 'parent_id' => 2, 'sort_order' => 3],
        
        // ç¬¬äºŒå±‚ï¼šç”¨æˆ·æŒ‡å—å­æ–‡æ¡£
        ['title' => 'ğŸ” åŸºç¡€æœç´¢', 'content' => '# åŸºç¡€æœç´¢ä½¿ç”¨

å¿«é€Ÿæ‰¾åˆ°æ‚¨éœ€è¦çš„æ–‡æ¡£ã€‚

## æœç´¢å…¥å£
- é¡¶éƒ¨æœç´¢æ¡†
- ä¾§è¾¹æ æœç´¢
- é«˜çº§æœç´¢é¡µé¢

## æœç´¢æŠ€å·§
- ä½¿ç”¨å…³é”®è¯
- æ”¯æŒæ¨¡ç³ŠåŒ¹é…
- ç»“æœæ’åº', 'parent_id' => 3, 'sort_order' => 1],
        
        ['title' => 'ğŸ‘¤ ä¸ªäººè®¾ç½®', 'content' => '# ä¸ªäººè®¾ç½®

ä¸ªæ€§åŒ–æ‚¨çš„ä½¿ç”¨ä½“éªŒã€‚

## ä¸ªäººèµ„æ–™
- ä¿®æ”¹å¯†ç 
- æ›´æ–°é‚®ç®±
- è®¾ç½®å¤´åƒ

## åå¥½è®¾ç½®
- ç•Œé¢ä¸»é¢˜
- é€šçŸ¥è®¾ç½®
- è¯­è¨€é€‰æ‹©', 'parent_id' => 3, 'sort_order' => 2],
        
        ['title' => 'ğŸ’¾ æ•°æ®å¯¼å‡º', 'content' => '# æ•°æ®å¯¼å‡ºåŠŸèƒ½

å°†æ–‡æ¡£å¯¼å‡ºä¸ºä¸åŒæ ¼å¼ã€‚

## æ”¯æŒæ ¼å¼
- **HTML**ï¼šç½‘é¡µæ ¼å¼
- **PDF**ï¼šæ‰“å°æ ¼å¼
- **Markdown**ï¼šæºæ–‡ä»¶æ ¼å¼

## å¯¼å‡ºé€‰é¡¹
- å•æ–‡æ¡£å¯¼å‡º
- æ‰¹é‡å¯¼å‡º
- åŒ…å«å­æ–‡æ¡£', 'parent_id' => 3, 'sort_order' => 3],
        
        // ç¬¬äºŒå±‚ï¼šå¼€å‘æ–‡æ¡£å­æ–‡æ¡£
        ['title' => 'ğŸ—ï¸ ç³»ç»Ÿæ¶æ„', 'content' => '# ç³»ç»Ÿæ¶æ„è®¾è®¡

æ–‡æ¡£ç®¡ç†ç³»ç»Ÿçš„æŠ€æœ¯æ¶æ„ã€‚

## å‰ç«¯æ¶æ„
- Bootstrap 5.3 æ¡†æ¶
- å“åº”å¼è®¾è®¡
- ç»„ä»¶åŒ–å¼€å‘

## åç«¯æ¶æ„
- PHP 8.2+ æ”¯æŒ
- SQLite æ•°æ®åº“
- MVC è®¾è®¡æ¨¡å¼', 'parent_id' => 4, 'sort_order' => 1],
        
        ['title' => 'ğŸ”Œ APIæ–‡æ¡£', 'content' => '# APIæ¥å£æ–‡æ¡£

ç³»ç»Ÿæä¾›çš„APIæ¥å£è¯´æ˜ã€‚

## è®¤è¯API
- ç”¨æˆ·ç™»å½•/ç™»å‡º
- æƒé™éªŒè¯

## æ–‡æ¡£API
- åˆ›å»ºæ–‡æ¡£
- æ›´æ–°æ–‡æ¡£
- åˆ é™¤æ–‡æ¡£
- æŸ¥è¯¢æ–‡æ¡£', 'parent_id' => 4, 'sort_order' => 2],
        
        ['title' => 'ğŸ”§ å¼€å‘æŒ‡å—', 'content' => '# å¼€å‘æŒ‡å—

ä¸ºå¼€å‘è€…æä¾›çš„æ‰©å±•æŒ‡å—ã€‚

## ç¯å¢ƒè¦æ±‚
- PHP 8.2+
- SQLite 3
- WebæœåŠ¡å™¨

## å¼€å‘å·¥å…·
- ä»£ç ç¼–è¾‘å™¨
- æ•°æ®åº“ç®¡ç†å·¥å…·
- ç‰ˆæœ¬æ§åˆ¶', 'parent_id' => 4, 'sort_order' => 3],
        
        // ç¬¬äºŒå±‚ï¼šå¸¸è§é—®é¢˜å­æ–‡æ¡£
        ['title' => 'â“ ç™»å½•é—®é¢˜', 'content' => '# ç™»å½•é—®é¢˜è§£å†³æ–¹æ¡ˆ

è§£å†³ç™»å½•ç›¸å…³å¸¸è§é—®é¢˜ã€‚

## å¿˜è®°å¯†ç 
- è”ç³»ç®¡ç†å‘˜é‡ç½®
- ä½¿ç”¨å¯†ç æ‰¾å›åŠŸèƒ½

## ç™»å½•å¤±è´¥
- æ£€æŸ¥ç”¨æˆ·åå¯†ç 
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
- æ£€æŸ¥ç½‘ç»œè¿æ¥', 'parent_id' => 5, 'sort_order' => 1],
        
        ['title' => 'ğŸ› å¸¸è§é”™è¯¯', 'content' => '# å¸¸è§é”™è¯¯åŠè§£å†³

ç³»ç»Ÿä½¿ç”¨ä¸­çš„å¸¸è§é”™è¯¯ã€‚

## æ–‡æ¡£æ— æ³•ä¿å­˜
- æ£€æŸ¥æƒé™
- æ¸…ç†ç¼“å­˜
- æ£€æŸ¥ç½‘ç»œ

## æœç´¢æ— ç»“æœ
- æ£€æŸ¥å…³é”®è¯
- æ‰©å¤§æœç´¢èŒƒå›´
- æ£€æŸ¥ç´¢å¼•çŠ¶æ€', 'parent_id' => 5, 'sort_order' => 2],
    ];
    
    $stmt = $db->prepare("INSERT INTO documents (title, content, parent_id, sort_order, user_id, is_public) VALUES (?, ?, ?, ?, 1, 1)");
    
    foreach ($docs as $doc) {
        $stmt->execute([
            $doc['title'],
            $doc['content'],
            $doc['parent_id'],
            $doc['sort_order']
        ]);
    }
    
    echo "âœ… æˆåŠŸåˆå§‹åŒ–20ç¯‡å¤šå±‚çº§æ–‡æ¡£ï¼\n";
    echo "ğŸ“Š æ–‡æ¡£ç»Ÿè®¡ï¼š\n";
    
    // æ˜¾ç¤ºå±‚çº§ç»Ÿè®¡
    $result = $db->query("SELECT parent_id, COUNT(*) as count FROM documents GROUP BY parent_id");
    $levels = $result->fetchAll(PDO::FETCH_ASSOC);
    
    echo "ğŸ“‚ å±‚çº§åˆ†å¸ƒï¼š\n";
    foreach ($levels as $level) {
        if ($level['parent_id'] === null) {
            echo "   æ ¹å±‚çº§: {$level['count']} ç¯‡æ–‡æ¡£\n";
        } else {
            echo "   çˆ¶æ–‡æ¡£ID {$level['parent_id']}: {$level['count']} ç¯‡å­æ–‡æ¡£\n";
        }
    }
    
    // æ˜¾ç¤ºæ–‡æ¡£æ ‘
    echo "\nğŸŒ³ æ–‡æ¡£æ ‘ç»“æ„ï¼š\n";
    
    function displayTree($parent_id = null, $level = 0) {
        global $db;
        $indent = str_repeat('  ', $level);
        $stmt = $db->prepare("SELECT id, title FROM documents WHERE parent_id " . ($parent_id === null ? "IS NULL" : "= ?") . " ORDER BY sort_order");
        if ($parent_id === null) {
            $stmt->execute();
        } else {
            $stmt->execute([$parent_id]);
        }
        
        $docs = $stmt->fetchAll(PDO::FETCH_ASSOC);
        foreach ($docs as $doc) {
            echo $indent . "ğŸ“„ " . $doc['title'] . " (ID: {$doc['id']})\n";
            displayTree($doc['id'], $level + 1);
        }
    }
    
    displayTree();
    
} catch (Exception $e) {
    echo "âŒ åˆå§‹åŒ–å¤±è´¥: " . $e->getMessage() . "\n";
}